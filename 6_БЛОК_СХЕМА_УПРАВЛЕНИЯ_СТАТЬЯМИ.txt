БЛОК-СХЕМА АЛГОРИТМА МОДУЛЯ УПРАВЛЕНИЯ СТАТЬЯМИ БЛОГА
ГБУЗ ПО «Островская межрайонная больница»
==========================================

ОБЩАЯ СХЕМА РАБОТЫ С БЛОГОМ
----------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  Запрос к   │
                    │  модулю     │
                    │  блога      │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ Просмотр     │  │ Создание     │  │ Редактирование│
│ списка       │  │ статьи       │  │ статьи        │
│ статей       │  │              │  │ (админка)     │
└──────────────┘  └──────────────┘  └──────────────┘

АЛГОРИТМ ПРОСМОТРА СПИСКА СТАТЕЙ (blog)
----------------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │  blog()     │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Получить    │
                    │ все статьи  │
                    │ из БД       │
                    │ Blog.objects│
                    │ .all()      │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Отсортировать│
                    │ по дате     │
                    │ (убывание)  │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Передать в  │
                    │ шаблон:     │
                    │ - posts     │
                    │ - title     │
                    │ - year      │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Рендер      │
                    │ blog.html   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   КОНЕЦ     │
                    └─────────────┘

АЛГОРИТМ ПРОСМОТРА ОТДЕЛЬНОЙ СТАТЬИ (blogpost)
----------------------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │ blogpost()  │
                    │ (parametr)  │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Получить    │
                    │ статью по ID│
                    │ Blog.objects│
                    │ .get(id=    │
                    │ parametr)   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Получить    │
                    │ комментарии │
                    │ к статье    │
                    │ Comment.    │
                    │ objects.     │
                    │ filter(     │
                    │ post=       │
                    │ parametr)   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ request.    │
                    │ method ==   │
                    │ "POST"?     │
                    └──────┬──────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
          ДА │                             │ НЕТ
            │                             │
            ▼                             ▼
    ┌─────────────┐              ┌─────────────┐
    │ Создать     │              │ Создать     │
    │ форму       │              │ пустую      │
    │ CommentForm │              │ форму       │
    │ (request.   │              │ CommentForm │
    │ POST)       │              │ ()          │
    └──────┬──────┘              └──────┬──────┘
           │                           │
           ▼                           │
    ┌─────────────┐                   │
    │ form.       │                   │
    │ is_valid()? │                   │
    └──────┬──────┘                   │
           │                           │
    ┌──────┴──────┐                   │
    │             │                   │
  ДА │             │ НЕТ               │
    │             │                   │
    ▼             ▼                   │
┌─────────┐  ┌─────────┐              │
│ Добавить│  │ Вернуть │              │
│ данные: │  │ форму с │              │
│ - author│  │ ошибками│              │
│ = user  │  │         │              │
│ - date =│  └────┬────┘              │
│ now()   │       │                   │
│ - post =│       │                   │
│ article │       │                   │
└────┬────┘       │                   │
     │            │                   │
     ▼            │                   │
┌─────────┐       │                   │
│ comment │       │                   │
│ .save() │       │                   │
└────┬────┘       │                   │
     │            │                   │
     ▼            │                   │
┌─────────┐       │                   │
│ redirect│       │                   │
│ ('blogpost',   │                   │
│  parametr)     │                   │
└────┬────┘       │                   │
     │            │                   │
     └────────────┴───────────────────┘
                    │
                    ▼
            ┌─────────────┐
            │ Передать в   │
            │ шаблон:      │
            │ - post_1    │
            │ - comments  │
            │ - form      │
            │ - title     │
            │ - year      │
            └──────┬──────┘
                   │
                   ▼
            ┌─────────────┐
            │ Рендер      │
            │ blogpost.   │
            │ html        │
            └──────┬──────┘
                   │
                   ▼
            ┌─────────────┐
            │   КОНЕЦ      │
            └─────────────┘

АЛГОРИТМ СОЗДАНИЯ НОВОЙ СТАТЬИ (newpost)
-----------------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │ newpost()   │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Проверить   │
                    │ права:      │
                    │ user.       │
                    │ is_superuser│
                    │ ?           │
                    └──────┬──────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
          ДА │                             │ НЕТ
            │                             │
            ▼                             ▼
    ┌─────────────┐              ┌─────────────┐
    │ request.    │              │ redirect    │
    │ method ==   │              │ ('home')    │
    │ "POST"?     │              │ или 403     │
    └──────┬──────┘              └──────┬──────┘
           │                             │
    ┌──────┴──────┐                      │
    │             │                      │
  ДА │             │ НЕТ                 │
    │             │                      │
    ▼             ▼                      │
┌─────────┐  ┌─────────┐                │
│ Создать │  │ Создать │                │
│ форму   │  │ пустую  │                │
│ BlogForm│  │ форму   │                │
│ (POST,  │  │ BlogForm│                │
│ FILES)  │  │ ()      │                │
└────┬────┘  └────┬────┘                │
     │            │                      │
     ▼            │                      │
┌─────────┐       │                      │
│ form.   │       │                      │
│ is_valid│       │                      │
│ ()?     │       │                      │
└────┬────┘       │                      │
     │            │                      │
┌────┴────┐       │                      │
│         │       │                      │
ДА │         │ НЕТ │                      │
│         │       │                      │
▼         ▼       │                      │
┌─────────┐ ┌─────────┐                 │
│ Добавить│ │ Вернуть │                 │
│ данные: │ │ форму с │                 │
│ - posted│ │ ошибками│                 │
│ = now() │ │         │                 │
│ - author│ └────┬────┘                 │
│ = user  │      │                      │
└────┬────┘      │                      │
     │           │                      │
     ▼           │                      │
┌─────────┐      │                      │
│ blog_f. │      │                      │
│ save()  │      │                      │
└────┬────┘      │                      │
     │           │                      │
     ▼           │                      │
┌─────────┐      │                      │
│ redirect│      │                      │
│ ('blog')│      │                      │
└────┬────┘      │                      │
     │           │                      │
     └───────────┴──────────────────────┘
                    │
                    ▼
            ┌─────────────┐
            │ Передать в   │
            │ шаблон:      │
            │ - blogform   │
            │ - title     │
            │ - year      │
            └──────┬──────┘
                   │
                   ▼
            ┌─────────────┐
            │ Рендер      │
            │ newpost.    │
            │ html        │
            └──────┬──────┘
                   │
                   ▼
            ┌─────────────┐
            │   КОНЕЦ      │
            └─────────────┘

АЛГОРИТМ УПРАВЛЕНИЯ СТАТЬЯМИ В АДМИНКЕ
--------------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │ /admin/app/ │
                    │ blog/       │
                    └──────┬──────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ Список       │  │ Добавление   │  │ Редактирование│
│ статей       │  │ статьи       │  │ статьи        │
│              │  │              │  │              │
│ - Фильтры    │  │ - Форма       │  │ - Форма с    │
│ - Поиск      │  │   создания    │  │   данными    │
│ - Сортировка │  │ - Валидация   │  │ - Валидация  │
│              │  │ - Сохранение  │  │ - Сохранение │
└──────────────┘  └──────────────┘  └──────────────┘
        │                  │                  │
        └──────────────────┴──────────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Проверка    │
                    │ прав доступа│
                    └──────┬──────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
          ДА │                             │ НЕТ
            │                             │
            ▼                             ▼
    ┌─────────────┐              ┌─────────────┐
    │ Выполнить   │              │ Ошибка 403 │
    │ операцию    │              │ (доступ    │
    │             │              │ запрещён) │
    └──────┬──────┘              └──────┬──────┘
           │                             │
           ▼                             │
    ┌─────────────┐                     │
    │ Сохранить в │                     │
    │ БД           │                     │
    └──────┬──────┘                     │
           │                            │
           └────────────────────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   КОНЕЦ      │
                    └─────────────┘

ОПИСАНИЕ ОПЕРАЦИЙ
-----------------

1. ПРОСМОТР СПИСКА (blog):
   - GET запрос
   - Получение всех статей из БД
   - Сортировка по дате (новые первыми)
   - Отображение в шаблоне

2. ПРОСМОТР СТАТЬИ (blogpost):
   - GET запрос с параметром ID
   - Получение статьи по ID
   - Получение комментариев к статье
   - Обработка формы комментария (POST)
   - Сохранение комментария
   - Редирект на ту же страницу

3. СОЗДАНИЕ СТАТЬИ (newpost):
   - Проверка прав (только суперюзер)
   - GET: отображение формы
   - POST: обработка формы
   - Валидация данных
   - Добавление автора и даты
   - Сохранение в БД
   - Редирект на список статей

4. УПРАВЛЕНИЕ В АДМИНКЕ:
   - CRUD операции (Create, Read, Update, Delete)
   - Фильтрация и поиск
   - Массовые операции
   - Управление изображениями и видео

ОБРАБОТКА ОШИБОК
----------------

┌─────────────┐
│ Ошибка      │
│ доступа?    │
└──────┬──────┘
       │
   ┌───┴───┐
   │       │
  ДА │     │ НЕТ
   │       │
   ▼       ▼
┌─────┐ ┌─────┐
│ 403 │ │ Продолжить│
└─────┘ └─────┘

┌─────────────┐
│ Ошибка      │
│ валидации?  │
└──────┬──────┘
       │
   ┌───┴───┐
   │       │
  ДА │     │ НЕТ
   │       │
   ▼       ▼
┌─────┐ ┌─────┐
│Вернуть│ │ Сохранить│
│форму с│ │ в БД     │
│ошибками│ └─────┘
└─────┘

