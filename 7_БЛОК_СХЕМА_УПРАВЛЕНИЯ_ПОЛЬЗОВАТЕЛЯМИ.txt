БЛОК-СХЕМА АЛГОРИТМА МОДУЛЯ УПРАВЛЕНИЯ ПОЛЬЗОВАТЕЛЯМИ
ГБУЗ ПО «Островская межрайонная больница»
==========================================

ОБЩАЯ СХЕМА УПРАВЛЕНИЯ ПОЛЬЗОВАТЕЛЯМИ
-------------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    └──────┬──────┘
                           │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
        ▼                   ▼                   ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ Регистрация  │  │ Авторизация  │  │ Управление   │
│ пользователя │  │ пользователя │  │ пользователями│
│              │  │              │  │ (админка)    │
└──────────────┘  └──────────────┘  └──────────────┘

АЛГОРИТМ РЕГИСТРАЦИИ (registration)
-----------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │registration│
                    │   ()       │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ request.   │
                    │ method ==  │
                    │ "POST"?    │
                    └──────┬──────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
          ДА │                             │ НЕТ
            │                             │
            ▼                             ▼
    ┌─────────────┐              ┌─────────────┐
    │ Создать     │              │ Создать     │
    │ форму       │              │ пустую      │
    │ UserCreation│              │ форму       │
    │ Form        │              │ UserCreation│
    │ (request.   │              │ Form()      │
    │ POST)       │              └──────┬──────┘
    └──────┬──────┘                     │
           │                            │
           ▼                            │
    ┌─────────────┐                     │
    │ form.       │                     │
    │ is_valid()? │                     │
    └──────┬──────┘                     │
           │                            │
    ┌──────┴──────┐                     │
    │             │                     │
  ДА │             │ НЕТ                 │
    │             │                     │
    ▼             ▼                     │
┌─────────┐  ┌─────────┐               │
│ reg_f = │  │ Вернуть │               │
│ form.   │  │ форму с │               │
│ save(   │  │ ошибками│               │
│ commit= │  │         │               │
│ False)  │  └────┬────┘               │
└────┬────┘       │                     │
     │            │                     │
     ▼            │                     │
┌─────────┐       │                     │
│ Установить│     │                     │
│ параметры:│     │                     │
│ - is_staff│     │                     │
│   = False│     │                     │
│ - is_active│    │                     │
│   = True │     │                     │
│ - is_     │     │                     │
│   superuser│    │                     │
│   = False │     │                     │
│ - date_   │     │                     │
│   joined =│     │                     │
│   now()   │     │                     │
│ - last_   │     │                     │
│   login = │     │                     │
│   now()   │     │                     │
└────┬────┘       │                     │
     │            │                     │
     ▼            │                     │
┌─────────┐       │                     │
│ reg_f.  │       │                     │
│ save()  │       │                     │
└────┬────┘       │                     │
     │            │                     │
     ▼            │                     │
┌─────────┐       │                     │
│ redirect│       │                     │
│ ('home')│       │                     │
└────┬────┘       │                     │
     │            │                     │
     └────────────┴─────────────────────┘
                    │
                    ▼
            ┌─────────────┐
            │ Передать в   │
            │ шаблон:      │
            │ - regform    │
            │ - title     │
            │ - year      │
            └──────┬──────┘
                   │
                   ▼
            ┌─────────────┐
            │ Рендер      │
            │ registration│
            │ .html       │
            └──────┬──────┘
                   │
                   ▼
            ┌─────────────┐
            │   КОНЕЦ      │
            └─────────────┘

АЛГОРИТМ АВТОРИЗАЦИИ (login)
-----------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │   login     │
                    │   (Django)  │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Проверить  │
                    │ метод      │
                    │ запроса    │
                    └──────┬──────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
          POST │                           │ GET
            │                             │
            ▼                             ▼
    ┌─────────────┐              ┌─────────────┐
    │ Получить   │              │ Отобразить │
    │ username и │              │ форму       │
    │ password   │              │ входа       │
    │ из request │              │             │
    └──────┬──────┘              └──────┬──────┘
           │                             │
           ▼                             │
    ┌─────────────┐                      │
    │ Проверить  │                      │
    │ credentials│                      │
    │ в БД       │                      │
    └──────┬──────┘                      │
           │                             │
    ┌──────┴──────┐                      │
    │             │                      │
  ДА │             │ НЕТ                  │
    │             │                      │
    ▼             ▼                      │
┌─────────┐  ┌─────────┐                │
│ Создать │  │ Вернуть │                │
│ сессию  │  │ форму с │                │
│         │  │ ошибкой │                │
│         │  │         │                │
└────┬────┘  └────┬────┘                │
     │           │                      │
     ▼           │                      │
┌─────────┐      │                      │
│ redirect│      │                      │
│ на      │      │                      │
│ главную │      │                      │
│ или     │      │                      │
│ next    │      │                      │
└────┬────┘      │                      │
     │           │                      │
     └───────────┴──────────────────────┘
                    │
                    ▼
            ┌─────────────┐
            │   КОНЕЦ      │
            └─────────────┘

АЛГОРИТМ ВЫХОДА (logout)
------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │   logout    │
                    │   (Django)  │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Удалить     │
                    │ сессию      │
                    │ пользователя│
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ redirect    │
                    │ на главную  │
                    │ (next_page= │
                    │  '/')       │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   КОНЕЦ      │
                    └─────────────┘

АЛГОРИТМ УПРАВЛЕНИЯ ПОЛЬЗОВАТЕЛЯМИ В АДМИНКЕ
--------------------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │ /admin/auth/│
                    │ user/       │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ Проверить  │
                    │ права:     │
                    │ is_staff   │
                    │ или        │
                    │ is_superuser│
                    └──────┬──────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
          ДА │                             │ НЕТ
            │                             │
            ▼                             ▼
    ┌─────────────┐              ┌─────────────┐
    │ Показать    │              │ Ошибка 403  │
    │ интерфейс   │              │ (доступ     │
    │ управления  │              │ запрещён)   │
    └──────┬──────┘              └──────┬──────┘
           │                             │
        ┌──┴────────────────────────────┘
        │
        ▼
┌───────────────────────────────────────┐
│ Операции с пользователями:           │
│                                       │
│ ┌─────────────────────────────────┐  │
│ │ 1. ПРОСМОТР СПИСКА              │  │
│ │    - Фильтрация                 │  │
│ │    - Поиск                      │  │
│ │    - Сортировка                 │  │
│ └─────────────────────────────────┘  │
│                                       │
│ ┌─────────────────────────────────┐  │
│ │ 2. СОЗДАНИЕ ПОЛЬЗОВАТЕЛЯ       │  │
│ │    - Форма создания            │  │
│ │    - Валидация данных          │  │
│ │    - Хеширование пароля        │  │
│ │    - Сохранение в БД            │  │
│ └─────────────────────────────────┘  │
│                                       │
│ ┌─────────────────────────────────┐  │
│ │ 3. РЕДАКТИРОВАНИЕ               │  │
│ │    - Изменение данных           │  │
│ │    - Изменение пароля           │  │
│ │    - Изменение прав доступа     │  │
│ │    - Активация/деактивация      │  │
│ └─────────────────────────────────┘  │
│                                       │
│ ┌─────────────────────────────────┐  │
│ │ 4. УДАЛЕНИЕ                    │  │
│ │    - Подтверждение             │  │
│ │    - Каскадное удаление        │  │
│ │      связанных данных          │  │
│ └─────────────────────────────────┘  │
│                                       │
│ ┌─────────────────────────────────┐  │
│ │ 5. МАССОВЫЕ ОПЕРАЦИИ           │  │
│ │    - Активация нескольких      │  │
│ │    - Деактивация нескольких    │  │
│ │    - Удаление нескольких       │  │
│ └─────────────────────────────────┘  │
└───────────────────────────────────────┘
        │
        ▼
┌─────────────┐
│ Сохранить  │
│ изменения  │
│ в БД       │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│   КОНЕЦ      │
└─────────────┘

АЛГОРИТМ ПРОВЕРКИ ПРАВ ДОСТУПА
-------------------------------

                    ┌─────────────┐
                    │   НАЧАЛО    │
                    │ Проверка    │
                    │ прав        │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ user.       │
                    │ is_         │
                    │ authenticated│
                    │ ?           │
                    └──────┬──────┘
                           │
            ┌──────────────┴──────────────┐
            │                             │
          ДА │                             │ НЕТ
            │                             │
            ▼                             ▼
    ┌─────────────┐              ┌─────────────┐
    │ user.       │              │ Доступ      │
    │ is_staff    │              │ запрещён   │
    │ ?           │              │             │
    └──────┬──────┘              └──────┬──────┘
           │                             │
    ┌──────┴──────┐                      │
    │             │                      │
  ДА │             │ НЕТ                  │
    │             │                      │
    ▼             ▼                      │
┌─────────┐  ┌─────────┐                │
│ user.   │  │ Доступ │                │
│ is_     │  │ только │                │
│ superuser│ │ к      │                │
│ ?       │  │ публичн│                │
└────┬────┘  │ страницам│              │
     │       └────┬────┘                │
     │            │                      │
┌────┴────┐       │                      │
│         │       │                      │
ДА │         │ НЕТ │                      │
│         │       │                      │
▼         ▼       │                      │
┌─────────┐ ┌─────────┐                 │
│ Полный │ │ Ограничен│                 │
│ доступ │ │ доступ  │                 │
│ к      │ │         │                 │
│ админке│ └────┬────┘                 │
└────┬────┘     │                      │
     │          │                      │
     └──────────┴──────────────────────┘
                    │
                    ▼
            ┌─────────────┐
            │   КОНЕЦ      │
            └─────────────┘

ОПИСАНИЕ ОПЕРАЦИЙ
------------------

1. РЕГИСТРАЦИЯ:
   - Создание нового пользователя
   - Установка параметров по умолчанию
   - Хеширование пароля
   - Сохранение в БД
   - Автоматический вход (опционально)

2. АВТОРИЗАЦИЯ:
   - Проверка credentials
   - Создание сессии
   - Установка cookies
   - Редирект на нужную страницу

3. ВЫХОД:
   - Удаление сессии
   - Очистка cookies
   - Редирект на главную

4. УПРАВЛЕНИЕ В АДМИНКЕ:
   - CRUD операции
   - Управление правами
   - Активация/деактивация
   - Сброс паролей
   - Массовые операции

УРОВНИ ДОСТУПА
--------------

┌─────────────────────────────────────────┐
│ ГОСТЬ (неавторизованный)                │
│ - Просмотр публичных страниц           │
│ - Регистрация                          │
│ - Запись на приём                      │
│ - Обратная связь                       │
│ ✗ Комментирование                     │
│ ✗ Создание статей                     │
│ ✗ Админка                             │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ ОБЫЧНЫЙ ПОЛЬЗОВАТЕЛЬ                   │
│ - Всё, что доступно гостю              │
│ ✓ Комментирование                     │
│ ✗ Создание статей                     │
│ ✗ Админка                             │
└─────────────────────────────────────────┘

┌─────────────────────────────────────────┐
│ СУПЕРПОЛЬЗОВАТЕЛЬ (is_superuser=True)  │
│ - Всё, что доступно обычному           │
│ ✓ Создание статей                      │
│ ✓ Полный доступ к админке              │
│ ✓ Управление пользователями           │
│ ✓ Управление всеми данными             │
└─────────────────────────────────────────┘

ОБРАБОТКА ОШИБОК
----------------

┌─────────────┐
│ Ошибка      │
│ валидации?  │
└──────┬──────┘
       │
   ┌───┴───┐
   │       │
  ДА │     │ НЕТ
   │       │
   ▼       ▼
┌─────┐ ┌─────┐
│Вернуть│ │ Продолжить│
│форму с│ │           │
│ошибками│ └─────┘
└─────┘

┌─────────────┐
│ Ошибка      │
│ доступа?    │
└──────┬──────┘
       │
   ┌───┴───┐
   │       │
  ДА │     │ НЕТ
   │       │
   ▼       ▼
┌─────┐ ┌─────┐
│ 403 │ │ Продолжить│
│ или │ │           │
│ 404 │ └─────┘
└─────┘

